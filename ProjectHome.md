## 15KHz Signal Generator - SIN, SAW, RAMP, SQUARE, PWM waveforms ##

---

This project uses as hardware the ST STM8L-DISCOVERY board and a few external components.

More about the ST STM8L-DISCOVERY board you can find here: http://www.st.com/web/catalog/tools/FM116/SC959/SS1673/PF250636?s_searchtype=partnumber

The project's startup base was ST application note AN3252: "Building a wave generator using STM8L-DISCOVERY" which was modified and adapted to be more practical.

The development toolchain used: STVD and Cosmic compiler.


**External components (beside the STM8L-DISCOVERY board)**

> Four external push buttons (Frequency and waveform setting)

> One external variable resistor (amplitude setting)

> One external Signal clipping LED

> LM358 operational amplifier and some resistors (for signal amplification - without it you get a maximum of 3V out of the DAC)

> External +12V supply (for the LM358 amplifier and STM8L-DISCOVERY board)

**Functionality of the pushbuttons:**

> Button 1: Increase frequency

> Button 2: Decrease frequency

> Button 3: Change waveform (SIN, RAMP, SAW, SQUARE, PWM)

> Button 4: Change Duty Cycle/Frequency when in PWM generation mode

**External variable resistor:**

> Sets the signal amplitude level (starting from a minimum of 3V) by amplifying the DAC generated signal (amplification range: 1X-5X, set by LM358 feedback resistors ). When the amplification request is too high compared to the level of the external power supply, signal clipping may occur and this is signalled by the external LED. Using an LM358 operational amplifier and an external voltage supply of 12V I got a maximum signal amplitude of 10.5V (without clipping).

**External LED:**

> This LED light up when signal clipping occurs. Signal clipping occurs when the amplification request is too high compared to the level of the external power supply.

**Onboard LCD:**

> On the onboard LCD is displayed information about the generated signal: waveform type, frequency and amplitude in the following manner: when you push the change waveform button, on the LCD is displayed the current generated waveform, when you push the increase/decrease frequency buttons, the current frequency of the generated signal is displayed on the LCD and when you act on the external variable resistor for setting the amplitude, on the LCD is displayed the current generated signal amplitude (minimum 3V).

**Future development**

> All the signal waveforms are generated by the STM8L152 DAC so I limited the frequency to 15Khz to keep signal distortion to an acceptable margin. The DAC limited speed is more visible on square signals because the change from LOW to HIGH and HIGH to LOW demands a full range swing from the DAC. This swing needs some time and is seen as a slope on the scope. As the frequency is increased, this rise time becomes more and more comparable to the signal period and the signal is more and more distorted. When you output Sinus signals, the change from one sample to the next is much smaller compared to this difference in square signals and the effect of high frequency generation of Sinus signals is the reduction of signal amplitude, the waveform is not distorted.

> It would have been nice to generate Square and PWM signals using high speed GPIO pins routed to the output of hardware timers in PWM mode. Using GPIO pins you can theoretically reach PWM signals in the Mhz region. Unfortunatelly there were no free GPIO pins :)

> I can drop the functionality of signal clipping and use this output to drive high speed PWM signals or I can change the onboard LCD with an external HD44780 compatible one which uses much less I/O pins and in this case many I/O pins will be freed.
> Maybe in many cases this DAC generated PWM signals are enough.